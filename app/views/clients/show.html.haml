- set_var 'locale', Tenant.current_tenant.locale
- set_var 'events', @events.map{|e| {title: e.client.full_name.to_s + " (" + e.jobs.collect{|r| r.service.name}.join(",").to_s+")", start: e.starts_at, end: e.ends_at, url: event_path(e), color: e.status_color}}
/- set_var 'events', @jobs.map{|e| {title: e.event.client.full_name.to_s + " (" + e.service.name.to_s+")", start: e.event.starts_at, end: e.event.ends_at, url: event_path(e.event), color: e.event.status_color}}
- model_class = Client
.row
  .col-lg-4
    .card
      .card-header
        .fa.fa-user
        =t '.title', :default => model_class.model_name.human.titleize
        .float-right
          = link_to '', edit_client_path(@client), class: "btn btn-warning fa fa-edit btn-sm" if policy(@client).edit?
          = link_to '', @client, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-danger fa fa-trash btn-sm" if policy(@client).destroy?
      .card-header
        = render 'clients/new_payment'
        = render 'clients/new_event'
      .card-body
        %b= model_class.human_attribute_name(:full_name) + ':'
        = @client.full_name
        %br
        %b= model_class.human_attribute_name(:phone_number) + ':'
        = link_to "tel:#{@client.phone_number}", class: "button" do
          #{number_to_phone(@client.phone_number)}
        /%a{:href => "viber://chat?number=#{@client.phone_number}"}
        /  Viber
        %br
        %b= model_class.human_attribute_name(:email) + ':'
        %a{:href => "mailto:#{@client.email}"}= @client.email
        %br
        %b= model_class.human_attribute_name(:date_of_birth) + ':'
        - if @client.date_of_birth.present?
          = @client.date_of_birth.strftime('%d/%b/%Y') 
          (#{@client.age})
        %br
        %b= model_class.human_attribute_name(:gender) + ':'
        = @client.gender
        %br
        %b= model_class.human_attribute_name(:address) + ':'
        - if @client.address?
          /= @client.address
          /#{@client.address[:street_address]}, #{@client.address[:city]}, #{@client.address[:state]}, #{@client.address[:zip]}
          = @client.address[:country]
          = @client.address[:city]
          = @client.address[:street]
          = @client.address[:zip]
        
        /= link_to @client.address, "https://www.google.com/maps/search/?api=1&query=760+West+Genesee+Street+Syracuse+NY+13204", :target => '_blank'
        %hr
        .fa.fa-balance-scale
        %b= model_class.human_attribute_name(:balance) + ':'
        = number_to_currency(@client.balance_cents, unit: "#{Tenant.current_tenant.default_currency.upcase}", format: "%n %u")
        %br
        .fa.fa-calendar-check
        %b= model_class.human_attribute_name(:jobs_sum) + ':'
        = number_to_currency(@client.jobs_sum_cents, unit: "#{Tenant.current_tenant.default_currency.upcase}", format: "%n %u")
        %br
        .fa.fa-hand-holding-usd
        %b= model_class.human_attribute_name(:inbound_payments_sum) + ':'
        = number_to_currency(@client.inbound_payments_sum_cents, unit: "#{Tenant.current_tenant.default_currency.upcase}", format: "%n %u")
        %hr
        %b= model_class.human_attribute_name(:next_event) + ':'
        - if @next_event.present?
          = distance_of_time_in_words(Time.now, @next_event) 
        %br
        %b= model_class.human_attribute_name(:last_event) + ':'
        - if @last_event.present?
          = distance_of_time_in_words(Time.now, @last_event)
        /%br
        /%b Status:
        /= status_label(@client.status)
        %hr
        %b= model_class.human_attribute_name(:comments) + ':'
        = @client.comments_count
        = render "comments/form"
        = render "comments/index"
    %p
  .col-lg-8
    %ul#myTab.nav.nav-tabs{:role => "tablist"}
      %li.nav-item
        %a#zero-tab.nav-link.active{"aria-controls" => "zero", "aria-selected" => "true", "data-toggle" => "tab", :href => "#zero", :role => "tab"}
          = t('sidebar.calendar')
      %li.nav-item
        %a#first-tab.nav-link{"aria-controls" => "first", "aria-selected" => "true", "data-toggle" => "tab", :href => "#first", :role => "tab"}
          .fa.fa-caret-down
          = t("sidebar.events") + ':'
          = @client.events_count
      %li.nav-item
        %a#second-tab.nav-link{"aria-controls" => "second", "aria-selected" => "false", "data-toggle" => "tab", :href => "#second", :role => "tab"}
          .fa.fa-caret-down
          = t("sidebar.inbound_payments") + ':'
          = @client.inbound_payments.count
      %li.nav-item
        %a#third-tab.nav-link{"aria-controls" => "third", "aria-selected" => "false", "data-toggle" => "tab", :href => "#third", :role => "tab"}
          .fa.fa-chart-line
          = t("sidebar.stats")
    #myTabContent.tab-content
      #zero.tab-pane.fade.show.active{"aria-labelledby" => "zero-tab", :role => "tabpanel"}
        %br
        #event_calendar
      /#first.tab-pane.fade.show{"aria-labelledby" => "first-tab", :role => "tabpanel"}
      /  = render 'events/index'
      #first.tab-pane.fade.show{"aria-labelledby" => "first-tab", :role => "tabpanel"}
        = render 'events/index'
      #second.tab-pane.fade{"aria-labelledby" => "second-tab", :role => "tabpanel"}
        = render 'inbound_payments/index'
      #third.tab-pane.fade{"aria-labelledby" => "third-tab", :role => "tabpanel"}
        .card
          .card-body
            .text-center 
              = t('.event_quantity_per_month')
            = column_chart @client.events.group_by_month(:starts_at).count, download: true
            %hr
            .text-center 
              = t('.payment_sum_per_month')
            = column_chart @client.inbound_payments.group_by_month(:created_at).sum('amount/100'), prefix: "#{Tenant.current_tenant.default_currency.upcase} ", download: true
            %hr
            .text-center 
              = t('.event_statuses')
            = pie_chart @client.events.group(:status).count, download: true
            %hr
            .text-center 
              = t('.favorite_services')
            = pie_chart @client.services.group('name').count, download: true
