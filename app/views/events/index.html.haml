= search_form_for @q, url: events_path do |f|
  .card.card-default
    .container-fluid
      .card-heading
        %h4.card-title.float-left{:style => "padding-top: 7.5px;"} 
          %b
            = controller.action_name.humanize.titleize
            events
        %h4.card-title.float-right{:style => "padding-top: 7.5px;"} 
          = link_to "", events_path, class: "btn btn-secondary fa fa-redo", title: 'Refresh', 'data-toggle' => 'tooltip', 'data-placement' => 'top'
          - if policy(Event).create?
            = link_to t('.new_event'), new_event_path, class: 'btn btn-sm btn-primary'
    .card-header
      .row
        .col-md-4
          Member
          /= f.search_field :jobs_member_full_name_cont, autofocus: true, class: "form-control", style: 'float: left; width: 100%; display: block', placeholder: "Member name", :autocomplete => :off
          = f.select :jobs_member_full_name_cont, Member.all.map{|c| [c.full_name, c.last_name]}, {include_blank: Member.all.length > 1}, class: 'selectize'
          Client
          /= f.search_field :client_full_name_cont, autofocus: true, class: "form-control", style: 'float: left; width: 100%; display: block', placeholder: "Client name", :autocomplete => :off
          = f.select :client_full_name_cont, Client.all.map{|c| [c.full_name, c.last_name]}, {include_blank: Client.all.length > 1}, class: 'selectize'
        .col-md-4
          .input-daterange
            Starts after
            = f.text_field :starts_at_gteq, "data-provide" => 'datepicker', class: "form-control", placeholder: "Date >= to", :autocomplete => :off
            Starts before
            = f.text_field :starts_at_lteq, "data-provide" => 'datepicker', class: "form-control", placeholder: "Date <= to", :autocomplete => :off
        .col-md-4
          Status
          = f.select :status_eq, Event.statuses.to_a.map { |w| [w[0].humanize, w[1]] }, {:include_blank => true}, :class => "form-control"
          Service
          /= f.search_field :jobs_service_name_cont, autofocus: true, class: "form-control", style: 'float: left; width: 100%; display: block', placeholder: "Service name", :autocomplete => :off
          = f.select :jobs_service_name_cont, Service.all.map{|c| [c.name, c.name]}, {include_blank: Service.all.length > 1}, class: 'selectize'
          .row
          = f.submit

.table-responsive
  %table#table1
    %thead
      %tr
        %th{:colspan => "3"}
        %th= sort_link @q, :client_last_name, "Client"
        %th= sort_link @q, :location_id, "Location"
        %th= sort_link @q, :starts_at, "Time"
        %th= sort_link @q, :status, "Status"
        %th Services
        %th Price
        %th Notes
    %tbody
      - @events.each do |event|
        %tr
          %td= link_to '', event, class: "btn btn-primary fa fa-eye btn-sm" if policy(event).show?
          %td= link_to '', edit_event_path(event), class: "btn btn-warning fa fa-edit btn-sm" if policy(event).update?
          %td= link_to '', event, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-danger fa fa-trash btn-sm" if policy(event).destroy?
          %td= link_to event.client, client_path(event.client)
          %td= link_to event.location, location_path(event.location)
          %td #{event.starts_at.strftime("%A")} #{event.starts_at.strftime('%d/%b/%Y %H:%M')} - #{event.ends_at.strftime('%H:%M')} (#{event.duration} min)
          %td= status_label(event.status)
          %td
            - event.jobs.each do |job|
              .row
              .badge.badge-secondary
                = link_to job.service.full_name_with_price, service_path(job.service), class: 'text-white'
                \/
                = link_to job.member, member_path(job.member), class: 'text-white'
          %td= number_to_currency(event.client_price_cents, :unit => "#{Tenant.current_tenant.default_currency.upcase} ")
          %td= truncate(event.notes, length: 25)
.container
  = will_paginate @events, renderer: WillPaginate::ActionView::BootstrapLinkRenderer
%br
