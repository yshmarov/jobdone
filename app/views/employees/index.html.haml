- model_class = Employee
= search_form_for @ransack_employees, as: :employees_search, url: employees_path do |f|
  %br
  .card.card-default
    .container-fluid
      .card-heading
        %h4.card-title.float-left{:style => "padding-top: 7.5px;"} 
          %b
            =t '.title', :default => model_class.model_name.human.pluralize.titleize
            = f.search_field :last_name_cont, autofocus: true, placeholder: "Surname"
            = f.submit
        %h4.card-title.float-right{:style => "padding-top: 7.5px;"} 
          = link_to '', employees_path, class: "btn btn-secondary fa fa-redo", title: 'Refresh', 'data-toggle' => 'tooltip', 'data-placement' => 'top'
          = link_to 'New Employee', new_employee_path, class: 'btn btn-sm btn-primary'
%table#table1
  %thead
    %tr
      %th= sort_link @ransack_employees, :last_name, "Name"
      %th
      %th
      %th Phone
      %th Email
      %th Birthday
      %th= sort_link @ransack_employees, :status, "Status"
      %th= sort_link @ransack_employees, :balance, "Balance"
      %th= sort_link @ransack_employees, :jobs_count, "Jobs"
      %th Location
      %th Skills
      %th Status

  %tbody
    - @employees.each do |employee|
      %tr
        %td= link_to employee.full_name, employee_path(employee), class: 'btn btn-sm btn-primary'
        %td= link_to 'Edit', edit_employee_path(employee), class: 'btn btn-sm btn-warning'
        %td= link_to 'Destroy', employee, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-sm btn-danger'
        %td
          = link_to "tel:#{employee.phone_number}", class: "button" do
            #{employee.phone_number}
        %td
          %a{:href => "mailto:#{employee.email}"}= employee.email
        %td
          - if employee.date_of_birth.present?
            #{employee.date_of_birth.strftime('%d/%b/%Y')} (#{employee.age})
        %td= status_label(employee.status)
        %td= number_to_currency(employee.balance_cents, :unit => "$")
        %td= employee.jobs_count
        %td= employee.location
        %td= employee.skills.collect{|r| r.service_category}.to_sentence
        %td
          /- if employee.user.present?
          /  - if employee.user.invitation_accepted_at?
          /    /= link_to 'x account', employee.user, :method => :delete, :data => { :confirm => 'Are you sure?' }, class: "btn btn-danger btn-xs"
          /  - else
          /    /= link_to 'x invitation', employee.user, :method => :delete, :data => { :confirm => 'Are you sure?' }, class: "btn btn-info btn-xs"
          /    Invitation pending
          /- else
          /  - unless employee.termination_date.present?
          /    - if employee.email.present?
          /      = simple_form_for(User.new, url: user_invitation_path) do |z|
          /        = z.input :email, input_html: {value: employee.personal_email}, as: :hidden
          /        = z.input :employee_id, input_html: {value: employee.id}, as: :hidden
          /        = z.button :submit, 'Invite', class: "btn btn-success btn-xs"
          /    - else
          /      Add email
          /  - else
          /    Finished
          /  - unless employee.associations?
          /    - if policy(employee).destroy?
          /      = link_to 'x totally', employee, :method => :delete, :data => { :confirm => 'Are you sure?' }, class: "btn btn-default btn-xs"

          - if employee.user.present?
            - if employee.user.invitation_accepted_at?
              Account Active. Can delete
              /= link_to 'x account', employee.user, :method => :delete, :data => { :confirm => 'Are you sure?' }, class: "btn btn-danger btn-xs"
            - else 
              Invitation sent. Can delete
              /= link_to 'x invitation', employee.user, :method => :delete, :data => { :confirm => 'Are you sure?' }, class: "btn btn-info btn-xs"
          - else
            - if employee.email.present?
              = simple_form_for(User.new, url: user_invitation_path) do |z|
                = z.input :email, input_html: {value: employee.email}, as: :hidden
                = z.input :employee_id, input_html: {value: employee.id}, as: :hidden
                = z.button :submit, 'Invite', class: "btn btn-success btn-xs"
            - else
              Add email to invite user
.container
  = will_paginate @employees, renderer: WillPaginate::ActionView::BootstrapLinkRenderer
%br
